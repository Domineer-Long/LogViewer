<!DOCTYPE html >
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Insert title here</title>
<!-- <script type="text/javascript"	src="http://cdn.socket.io/stable/socket.io.js"></script> -->
<style type="text/css">
body {
	margin: 0;
	padding: 0;
}

.container {
	position: relative;
	top: 0;
	right: 0;
	left: 0;
	bottom: 0;
}

.container_body {
	overflow-y: auto;
	padding-bottom: 25px;
}

.container_footer {
	position: fixed;
	right: 0;
	bottom: 0;
	left: 0;
}

body,.container_footer {
	background-color: #ffffff;
}
</style>
</head>
<body>
	<div class="container">
		<div class="container_body" id="log_body"></div>

		<div class="container_footer">
			<div style="position: relative;">
				<div style="float: left">
					<button type="button" id="send">send</button>
					<input type="text" name="message" id="message" />
				</div>
				<div style="float: right">
				
					<button type="button" id="clearAll">清屏</button>
					<button type="button" id="pause">暂停打印日志</button>
					<button type="button" id="resume">继续打印日志</button>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
<script type="text/javascript">
	var Log = {
		PAUSE : "pause",
		RESUME : "resume",
		maxLine:10000
	};
	var currentUrl=window.location.href;
	var resource=currentUrl.substring(("http://"+window.location.host).length+1,currentUrl.length);
	var contextPath=resource.replace('index\.html',"");
	var url = "ws://"+window.location.host+"/"+contextPath+"viewer/log";
	var logBody = document.getElementById("log_body");
	var line=0;
	document.getElementById("send").onclick = function() {
		var value = document.getElementById("message").value;
		if (value.replace(/\s/ig, '').length == 0)
			value = "请问撸主你在说什么？";
		Log.sendMessage(value);
	}
	document.getElementById("clearAll").onclick = function() {
		console.log("清屏");
		logBody.innerHTML="";
		line=0;
	}
	document.getElementById("pause").onclick = function() {
		console.log("暂停日志打印");
		Log.sendMessage(Log.PAUSE);
	}
	document.getElementById("resume").onclick = function() {
		console.log("继续打印日志");
		Log.sendMessage(Log.RESUME);
	}
	Log.initWebSocket = function() {
		if (window.hasOwnProperty('WebSocket')) {
			Log.socket = new WebSocket(url);
		} else if (window.hasOwnProperty('MozWebSocket')) {
			Log.socket = new MozWebSocket(url);
		}
		Log.socket.onopen = function(event) {
			console.log("已连接websocket");
		}
		Log.socket.onmessage = function(message) {
			console.log("接收到一条message： " + message.data);
			var div = document.createElement("div");
			div.innerHTML = message.data;
			logBody.appendChild(div);
			line++;
			if(line>Log.maxLine){
				logBody.removeChild(logBody.firstChild);
			}
			div.scrollIntoView();
		}
	}
	Log.sendMessage = function(message) {
		if (Log.socket.readyState == WebSocket.CLOSED
				|| Log.socket.readyState == WebSocket.CLOSING) {
			console.log("websocket已关闭，进行重新连接...");
			Log.initWebSocket();
		}
		Log.socket.send(message);
		console.log("发送一条message:  " + message);
	}
	Log.initWebSocket();
	window.onunload=function(){
		if(Log.socket&&Log.socket.readyState==WebSocket.OPEN){
			Log.socket.disconnect();
		}
	}
</script>